<!DOCTYPE html>
<html lang="fa" >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ایمالز </title>
    <link rel="stylesheet" href="./assets/css/output.css">
    <link rel="shortcut icon" href="./assets/images/btn.png" type="image/x-icon">
    <style>
        @layer base {
        .no-spinner {
        -moz-appearance: textfield;
        }
  .no-spinner::-webkit-outer-spin-button,
  .no-spinner::-webkit-inner-spin-button {
    margin: 0;
    -webkit-appearance: none;
  }
}

        /* Custom animations for the final page */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 193, 7, 0.8); }
        }
        
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        .glow-animation {
            animation: glow 2s ease-in-out infinite;
        }
        
        .hexagonal-box {
            clip-path: polygon(10% 0%, 90% 0%, 100% 50%, 90% 100%, 10% 100%, 0% 50%);
        }
    </style>
</head>
<body class="w-full h-auto bg-space-dark " >
    <div class="w-full h-full flex justify-center items-center "  >
        <!-- pattern-diagonal-lines pattern-purple-500 pattern-bg-purple-600 
        pattern-size-10 pattern-opacity-100 -->
        <div class="w-full h-auto rounded-lg" >
            <div class="game w-full flex justify-center items-center h-full  overflow-hidden ">

            <!-- =========PAGE  1| START========== -->
               <div class=" min-h-screen w-full lg:w-96 mx-auto relative overflow-hidden bg-cover bg-center" id="sen2" style="background-image: url('./assets/images/space-bg.jpg');">
                   <!-- Content Container -->
                   <div class="relative z-20 mt-[55vh] px-6 pb-8 ">
                       <!-- Welcome Section -->
                       <div class="text-center ">
                           <h1 class="text-white text-2xl font-yekan-bold mb-2">
                               به <span class="text-orange-400">ایلماز</span> خوش اومدی!
                           </h1>
                       </div>
                       <!-- Login Form -->
                       <div class="space-y-4 max-w-md mx-auto " id="phone_box">
                        <div class="flex justify-center items-center w-full">
                            <p class="text-white/80 text-sm font-yekan mx-auto">وارد شو و ماجراجویی‌تو شروع کن</p>
                        </div>
                           <!-- Name Input -->
                           <div id="name_box">
                               <div id="getname">
                                   <div class="bg-[#1E2547]/70 backdrop-blur-sm border border-white/20 rounded-full px-5 py-4 flex items-center justify-between">
                                       <img src="./assets/images/user0231.svg" alt="" class="w-6 h-6">
                                       <input id="nameinput" type="text" class="bg-transparent border border-white/20  text-white text-right font-yekan placeholder:text-white/60 border-none outline-none w-full pr-3" placeholder="نام و نام خانوادگی" autocomplete="off"/>
                                   </div>
                               </div>
                           </div>

                           <!-- Phone Input -->
                           <div>
                               <div id="getphone">
                                   <div class="bg-[#1E2547]/70 backdrop-blur-sm border border-white/20 rounded-full px-5 py-4 flex items-center justify-between">
                                       <img src="./assets/images/phone.svg" alt="" class="w-6 h-6">
                                       <input id="getphoneinput" type="tel" class="bg-transparent text-white text-right font-yekan placeholder:text-white/60 border-none outline-none w-full pr-3" placeholder="شماره موبایل" pattern="09(0[1-2]|1[0-9]|3[0-9]|2[0-1])-?[0-9]{3}-?[0-9]{4}" autocomplete="off"/>
                                   </div>
                               </div>
                           </div>

                           <!-- Submit Button -->
                           <div class="text-center mt-8">
                               <div class="mx-auto w-2/3 cursor-pointer" onclick="serveRequest('0')">
                                   <button id="submitButton" class="bg-[#FF4438] hover:bg-[#FF4438]/90 text-white font-yekan-bold py-4 px-8 rounded-full flex items-center justify-center gap-2 transition-all duration-300 w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transform hover:-translate-y-1 active:translate-y-0">
                                       <span>دریافت کد</span>
                                       <img src="./assets/images/btn.png" alt="" class="w-8 h-8">
                                   </button>
                               </div>
                           </div>

                           <!-- Error Message -->
                           <div class="text-center mt-4">
                               <p class="text-red-400 text-sm font-yekan" id="errortext"></p>
                           </div>
                       </div>

                       <!-- Verification Code Section -->
                       <div id="submit_btn_disabled" class=" max-w-md mx-auto hidden">
                           <!-- Welcome Message -->
                           <div class="text-center mb-8">

                               <p class="text-white/80 text-sm font-yekan mb-4">
                                   کد ارسال شده به شماره <span class="font-yekan-bold" id="phone-display">09197752246</span> را وارد کنید
                               </p>
                           </div>

                           <!-- Verification Code Inputs -->
                           <div class="verify_code">
                               <div class="flex justify-center items-center space-x-2 rtl:space-x-reverse mb-6">
                                   <input id="code-input-0" class="w-16 h-20 bg-[#1E2547]/70 border border-white/20 backdrop-blur-sm rounded-[40px] text-white text-2xl font-bold text-center  outline-none focus:ring-2 focus:ring-white/50" type="text" maxlength="1" autocomplete="off" placeholder="-">
                                   <input id="code-input-1" class="w-16 h-20 bg-[#1E2547]/70 border border-white/20 backdrop-blur-sm rounded-[40px] text-white text-2xl font-bold text-center  outline-none focus:ring-2 focus:ring-white/50" type="text" maxlength="1" autocomplete="off" placeholder="-">
                                   <input id="code-input-2" class="w-16 h-20 bg-[#1E2547]/70 border border-white/20 backdrop-blur-sm rounded-[40px] text-white text-2xl font-bold text-center  outline-none focus:ring-2 focus:ring-white/50" type="text" maxlength="1" autocomplete="off" placeholder="-">
                                   <input id="code-input-3" class="w-16 h-20 bg-[#1E2547]/70 border border-white/20 backdrop-blur-sm rounded-[40px] text-white text-2xl font-bold text-center  outline-none focus:ring-2 focus:ring-white/50" type="text" maxlength="1" autocomplete="off" placeholder="-">
                                   <input id="code-input-4" class="w-16 h-20 bg-[#1E2547]/70 border border-white/20 backdrop-blur-sm rounded-[40px] text-white text-2xl font-bold text-center  outline-none focus:ring-2 focus:ring-white/50" type="text" maxlength="1" autocomplete="off" placeholder="-">
                               </div>

                              
                               <div class="text-center mb-6">
                                <!-- fix number button this close verification code section and open login form again  -->
                                   <p class="text-red-400 text-sm font-yekan"  onclick="openLoginForm()">شماره را اشتباه وارد کردم!</p>
                               </div>

                               <!-- Timer -->
                               <p class="text-white/80 text-center text-sm font-yekan mb-6">
                                   کد برای شما ارسال شد و تا
                                   <span id="js-timeout" class="font-yekan-bold">2:00</span>
                                   دیگر منقضی میشود.
                               </p>

                               <!-- Submit Button -->
                               <div class="text-center">
                                   <div class="cursor-pointer" onclick="serveRequest('1')">
                                       <button class="bg-[#FF4438] hover:bg-[#FF4438]/90 text-white font-yekan-bold py-4 px-8 rounded-full flex items-center justify-center gap-2 transition-all duration-300 w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transform hover:-translate-y-1 active:translate-y-0">
                                           <span> بزن بریم</span>
                                           <img src="./assets/images/btn.png" alt="" class="w-8 h-8">
                                             
                                       </button>
                                   </div>
                               </div>

                               <!-- Error Message -->
                               <div class="text-center mt-4">
                                   <p class="text-red-400 text-sm font-yekan" id="errortext2"></p>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
               
         
               <!-- =========PAGE  2| START========== -->

               <div class="hidden w-full h-screen" id="game">

                <iframe src="./assets/game/index.html?v=1.0.1"  id="myIframe" class="w-full h-full" >
                </iframe>

       
               </div>
               <!-- =========PAGE 2 | END========== -->
               <!-- =========PAGE 3 | START========== -->
               <div class="hidden min-h-screen w-full lg:w-96 mx-auto relative overflow-hidden text-white" id="sen5">
                <!-- Background with diagonal pattern -->
                <div class="w-full lg:w-full  h-screen bg-gradient-to-b from-blue-900 via-purple-900 to-blue-800 relative">
                    <!-- Diagonal pattern overlay -->
                    <div class="absolute inset-0 opacity-10" style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px);"></div>
                    
                    <!-- Golden coins decoration -->
                    <div class="absolute top-8 right-8 w-12 h-12 bg-yellow-400 rounded-full flex items-center justify-center glow-animation">
                        <span class="text-yellow-800 text-xl">★</span>
                    </div>
                    <div class="absolute bottom-32 left-4 w-8 h-8 bg-yellow-400 rounded-full flex items-center justify-center glow-animation" style="animation-delay: 0.5s;">
                        <span class="text-yellow-800 text-sm">★</span>
                    </div>
                    <div class="absolute bottom-20 right-4 w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center glow-animation" style="animation-delay: 1s;">
                        <span class="text-yellow-800 text-lg">★</span>
                    </div>

                    <div class="relative z-10 flex flex-col items-center justify-center h-full px-6">
                        <!-- Top Section - Hexagonal Text Box -->
                        <div class="my-8 mx-auto">
                            <div class="bg-gray-800/80 backdrop-blur-sm hexagonal-box px-8 py-6 text-center shadow-xl border border-gray-600/30">
                                <p class="text-white text-2xl font-yekan-bold mb-2">تبریک :)</p>
                                <p class="text-white text-xl font-yekan">
                                    شما <span id="scorebox" class="text-orange-400 font-yekan-bold text-2xl">45</span> امتیاز گرفتید!
                                </p>
                            </div>
                        </div>

                        <!-- Middle Section - Rocket Character -->
                        <div class="flex-1 flex items-center justify-center mb-4">
                            <div class="w-64 h-64 flex items-center justify-center">
                                <img src="./assets/images/finalpage_picture.png" alt="Rocket Character" class="w-full h-full object-contain floating-animation">
                            </div>
                        </div>

                        <!-- Bottom Section - Button -->
                        <div class="mb-8 text-center">
                            <p class="text-white/80 text-sm font-yekan mb-6">برای دیدن رتبه‌تون کلیک کنید</p>
                            <a href="{% url 'campaigns:leaderboard' %}" 
                               class="bg-[#FF4438] hover:bg-[#FF4438]/90 text-white font-yekan-bold py-4 px-8 rounded-full flex items-center justify-center gap-2 transition-all duration-300 w-full max-w-xs mx-auto shadow-lg hover:shadow-xl transform hover:-translate-y-1 active:translate-y-0">
                                <span>دیدن رتبه</span>
                                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
               </div>
               <!-- =========PAGE 3 | END========== -->
        </div>
    </div>
    </div>
</body>
</html>

<script>
  
    var lead_url = window.location.href.split('?')[0];


    // Get the query string from the URL
    const queryString = window.location.search;
    
    // Create a URLSearchParams object
    const urlParams = new URLSearchParams(queryString);

    // Get the value of the product parameter
    const viral = urlParams.get('viral');
</script>


<script src="./assets/js/timer.js"></script>
<script src="./assets/js/javaScript.js?v=1.0.5"></script>

<script>
    function postMsg(msg)
    {
        var iFrame = document.getElementById('myIframe').contentWindow
        iFrame.postMessage(msg, domain);
    }
    window.onmessage = function(e) {
        // Check if the data is JSON
        if (isValidJSON(e.data)) {
            var data = JSON.parse(e.data); 
            console.log(data.score);
            if (data.score >= 0){

                endGame(data.score);

            }else if(data.api) {
                console.log(data.api)
        }
        } else {
            // Handle non-JSON data
            console.log("Received non-JSON data: " + e.data);
            // Handle the non-JSON data in a way that makes sense for your application
        }
    };

    function isValidJSON(data) {
        try {
            JSON.parse(data);
            return true;
        } catch (e) {
            return false;
        }
    };
    function lastpage() {
            document.getElementById("game").style.display = "none";
            document.getElementById("sen5").style.display = "flex";
            document.getElementById("score_new").innerHTML = data.score;
            // For WhatsApp

            const whatsappLink = document.getElementById('WhatsApp_link');
            whatsappLink.href = `https://wa.me/?text=${encodeURIComponent('بازی ایمالز  رو انجام بده و برنده پک عشق شو')}%0A${lead_url}`;

            // For Telegram
            const telegramLink = document.getElementById('Telegram_link');
            telegramLink.href = `https://t.me/share/url?url=${lead_url}&text=${encodeURIComponent('بازی ایمالز  رو انجام بده و برنده پک عشق شو')}`;

            
    };
</script>


<script>

    let code = ''
    const form = document.querySelector('.verify_code')
    const KEYBOARDS = {
        backspace: 8,
        arrowLeft: 37,
        arrowRight: 39,
    }

    // Simple verification code auto-focus implementation
    function setupVerificationInputs() {
        const codeInputs = [
            document.getElementById('code-input-0'),
            document.getElementById('code-input-1'),
            document.getElementById('code-input-2'),
            document.getElementById('code-input-3'),
            document.getElementById('code-input-4')
        ];

        codeInputs.forEach((input, index) => {
            if (!input) return;

            input.addEventListener('input', function(e) {
                // Only allow numbers
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
                
                // Move to next input if digit entered
                if (e.target.value.length === 1 && index < codeInputs.length - 1) {
                    codeInputs[index + 1].focus();
                }
                
                // Clear error message
                const errorElement = document.getElementById("errortext2");
                if (errorElement) errorElement.innerText = "";
            });

            input.addEventListener('keydown', function(e) {
                // Handle backspace
                if (e.keyCode === 8 && e.target.value === '' && index > 0) {
                    codeInputs[index - 1].focus();
                    codeInputs[index - 1].value = '';
                }
                
                // Handle arrow keys
                if (e.keyCode === 37 && index > 0) { // left arrow
                    e.preventDefault();
                    codeInputs[index - 1].focus();
                }
                if (e.keyCode === 39 && index < codeInputs.length - 1) { // right arrow
                    e.preventDefault();
                    codeInputs[index + 1].focus();
                }
            });

            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').replace(/[^0-9]/g, '').slice(0, 5);
                
                for (let i = 0; i < pastedData.length && (index + i) < codeInputs.length; i++) {
                    codeInputs[index + i].value = pastedData[i];
                }
                
                const nextIndex = Math.min(index + pastedData.length, codeInputs.length - 1);
                codeInputs[nextIndex].focus();
            });
        });
    }

    // Call setup function when page loads and when verification section opens
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupVerificationInputs);
    } else {
        setupVerificationInputs();
    }

    // Global function to open verification section
    window.openVerificationSection = function() {
        document.getElementById("phone_box").style.display = "none";
        document.getElementById("submit_btn_disabled").style.display = "block";
        
        setTimeout(() => {
            setupVerificationInputs();
            const firstInput = document.getElementById('code-input-0');
            if (firstInput) {
                firstInput.focus();
            }
        }, 100);
    };

    // Enhance the openLoginForm function to also setup inputs
    window.openLoginForm = function() {
        document.getElementById("phone_box").style.display = "block";
        document.getElementById("submit_btn_disabled").style.display = "none";
        
        // Clear verification inputs
        for (let i = 0; i < 5; i++) {
            const input = document.getElementById(`code-input-${i}`);
            if (input) input.value = '';
        }
    };

</script>




</body>
</html>